# TASKS.md — 국회 보좌진 **프롬프트 생성기** 테스크 관리

> 본 문서는 PRD, RULES.md, ENGINEERING_RULES.md를 실행 가능한 **테스크 단위**로 분해합니다.  
> 배포 환경은 **Vercel + Next.js(App Router)** 기준이며, 단일 생성(Edge)과 멀티스텝(Node) 경로를 분리 운용합니다.

---

## 0) 빠른 링크

- PRD: `/docs/PRD.md`
- RULES: `/docs/RULES.md`
- ENGINEERING_RULES: `/docs/ENGINEERING_RULES.md`
- 룰팩 폴더: `/rulepacks/**`
- 체크리스트 폴더: `/checklists/**`
- 스키마 폴더: `/specs/**`

---

## 1) 역할 & 책임(예시)

- **PM**: 요구사항 관리, 스프린트 계획, 수용 기준 승인
- **Tech Lead**: 아키텍처/품질 기준 수립, 코드 리뷰
- **FE**: Next.js UI/UX, 접근성, 상태관리
- **BE**: API 라우트, 룰팩 로더, 토큰/로그/레이트리밋
- **QA**: 시나리오/회귀/성능/접근성 테스트 및 보고

---

## 2) 워크플로우 & 칸반 컬럼

- **Backlog → Ready → In-Progress → Code Review → QA → Done**
- MR/PR 머지 조건: Lint/Typecheck/Unit/API 테스트 **통과 + 1명 이상 리뷰 승인**

---

## 3) 라벨 & 우선순위

- **우선순위**: P0(치명) · P1(높음) · P2(보통) · P3(낮음)
- **라벨**: `frontend`, `backend`, `rulepacks`, `infra`, `observability`, `security`, `docs`, `qa`, `performance`, `node-route`, `edge-route`

---

## 4) Definition of Ready (DoR)

- [ ] 수용 기준/테스트 기준이 명확하다
- [ ] 외부 의존성/결정사항(ADR)이 정리됐다
- [ ] 추정(예: 2~4h/1~2d 등)이 있다
- [ ] UI/API 계약이 확정(또는 Mock 포함)됐다

## 5) Definition of Done (DoD)

- [ ] 기능 동작 + 단위/통합 테스트 통과
- [ ] 로그/메트릭/에러 코드 규약 준수
- [ ] 접근성/복사 버튼/키보드 내비게이션 확인
- [ ] 문서(README/변경점) 갱신
- [ ] 프리뷰 배포 확인 & 스모크 테스트 통과

---

## 6) 스프린트 계획(예: Sprint 01 · 2주)

**목표**: MVP(보도자료/연설문/SNS/질의서/보고서/언론스크랩 + 3레벨) Edge 경로 배포, 평균 토큰 < 900

| ID                             | 테스크                 | 설명                                              | 라벨                | 우선 | 담당 | ETA        | 의존성        | 상태         |
| ------------------------------ | ---------------------- | ------------------------------------------------- | ------------------- | ---- | ---- | ---------- | ------------- | ------------ |
| **Phase 1: 기반 인프라**       |                        |                                                   |                     |      |      |            |               |              |
| S01-01                         | 리포지토리 초기화      | Next.js TS strict, ESLint/Prettier, CI 세팅       | infra               | P1   | @    | YYYY-MM-DD | -             | Ready        |
| S01-02                         | Vercel 프로젝트/도메인 | 환경변수/프리뷰/롤백 확인                         | infra               | P1   | @    | YYYY-MM-DD | S01-01        | Ready        |
| **Phase 2: 핵심 룰팩 시스템**  |                        |                                                   |                     |      |      |            |               |              |
| S01-05                         | 기본 룰팩 v1           | 6개 형식 룰팩 작성 (press_release~media_scraping) | rulepacks           | P0   | @    | YYYY-MM-DD | S01-01        | **우선시작** |
| S01-06                         | 체크리스트 v1          | 6개 형식별 중급 체크리스트 작성                   | rulepacks           | P0   | @    | YYYY-MM-DD | S01-05        | Ready        |
| S01-04                         | 룰팩 스키마/로더       | `rulepack.schema.yaml`/YAML 로더                  | rulepacks           | P0   | @    | YYYY-MM-DD | S01-05        | In-Progress  |
| **Phase 3: API 계층**          |                        |                                                   |                     |      |      |            |               |              |
| S01-03                         | Zod 스키마             | `UserInput`, `PromptResponse` 정의 (6개 형식)     | backend             | P0   | @    | YYYY-MM-DD | S01-04        | In-Progress  |
| S01-10                         | LLM 래퍼               | 모델/파라미터 통일, 타임아웃                      | backend             | P1   | @    | YYYY-MM-DD | S01-03        | Ready        |
| S01-08                         | 토큰 가드              | 레벨별 max_tokens/총 토큰 로깅                    | backend             | P1   | @    | YYYY-MM-DD | S01-03        | Ready        |
| S01-09                         | 레이트리밋             | IP/사용자 기준, 429 처리                          | backend, security   | P1   | @    | YYYY-MM-DD | S01-02        | Ready        |
| S01-07                         | Edge API `/api/prompt` | 생성 1콜 + 검사 + 경고 반환                       | backend, edge-route | P0   | @    | YYYY-MM-DD | S01-03,S01-10 | Ready        |
| **Phase 4: 사용자 인터페이스** |                        |                                                   |                     |      |      |            |               |              |
| S01-11                         | 기본 UI                | 주제 입력 + 6개 형식/레벨/옵션 + 생성/복사        | frontend            | P0   | @    | YYYY-MM-DD | S01-07        | Ready        |
| S01-12                         | 접근성                 | 포커스/ARIA/키보드 내비                           | frontend            | P2   | @    | YYYY-MM-DD | S01-11        | Ready        |
| **Phase 5: 검증 및 배포**      |                        |                                                   |                     |      |      |            |               |              |
| S01-13                         | 로깅/메트릭            | requestId, tokens, duration, warnings             | observability       | P1   | @    | YYYY-MM-DD | S01-07        | Ready        |
| S01-14                         | 유닛/API 테스트        | 6개 형식별 스키마/룰팩/엔드포인트                 | qa                  | P0   | @    | YYYY-MM-DD | S01-07,S01-11 | Ready        |
| S01-15                         | 프리뷰 배포 & 스모크   | 18개 대표 케이스 점검 (6형식×3레벨)               | qa                  | P0   | @    | YYYY-MM-DD | S01-14        | Ready        |

---

## 7) 제품 백로그 (우선순위 상위)

- **[P0]** 보도자료/연설문/SNS/질의서/보고서/언론스크랩 각 3레벨 **수용 기준** 정밀화(누락/금지어/길이)
- **[P1]** 경고 배지(체크리스트 불통과 시) UI 표시
- **[P1]** 토픽 민감도 힌트(정치/의료/금융) → 검증·출처 지시 강화
- **[P1]** 토큰/요청 월간 상한 & 알림
- **[P2]** 프리셋 저장/불러오기(개인)
- **[P2]** SNS 플랫폼별 N안(variants)
- **[P2]** 스냅샷 테스트(레벨/형식별 10개)
- **[P3]** 조직 공유 룰팩/버전 관리 + 대시보드

---

## 8) 기능 테스크 템플릿

```md
### [Feature] {간단 제목}

- **배경**: (왜 필요한가)
- **수용 기준(AC)**:
  - [ ] …
  - [ ] …
- **테스트**:
  - [ ] 유닛
  - [ ] API
  - [ ] 스냅샷/시나리오
- **리스크/의존성**: …
- **추정**: …
```

## 9) 버그 템플릿

```md
### [Bug] {증상 요약}

- **환경**: (브라우저/런타임/버전)
- **재현 단계**:
  1. …
  2. …
- **기대 vs 실제**:
- **로그/스크린샷**:
- **심각도**: Blocker/Critical/Major/Minor
```

## 10) 스파이크(조사) 템플릿

```md
### [Spike] {주제}

- **질문**:
- **가설/접근**:
- **결과**:
- **권고**:
- **타임박스**: Nh
```

---

## 11) 회의/데일리 템플릿

```md
### Daily (YYYY-MM-DD)

- 어제: …
- 오늘: …
- 블로커: …
```

---

## 12) 릴리스 체크리스트

- [ ] 프리뷰에서 P50<1.5s, P95<3s (18개 케이스: 6형식×3레벨)
- [ ] 평균 토큰 < 900 / 요청 (6개 형식 모두)
- [ ] 경고/금지어/누락 0건 (6개 형식별 샘플 케이스)
- [ ] 6개 형식별 체크리스트 통과율 ≥ 85%
- [ ] 새로운 3개 형식(질의서/보고서/언론스크랩) 품질 검증 완료
- [ ] 문서(PRD/RULES/ENGINEERING_RULES) 최신화
- [ ] 룰팩 v1 (6개 형식) 버전 확정
- [ ] 롤백 플랜 확인

---

## 13) 리스크 레지스터

| ID       | 리스크                           | 영향             | 확률     | 대응/완화                                | 상태     |
| -------- | -------------------------------- | ---------------- | -------- | ---------------------------------------- | -------- |
| R-01     | 과도한 템플릿화로 진부함         | 품질저하         | 중       | 룰팩 랜덤화/동의어 슬롯                  | Open     |
| R-02     | 토큰 급증(레벨 초과)             | 비용상승         | 중       | max_tokens 하드캡+축약 규칙              | Open     |
| R-03     | Vercel Edge 제약                 | 기능제한         | 중       | 복잡경로 Node 라우트 분리                | Open     |
| R-04     | 민감주제 오남용                  | 컴플라이언스     | 저       | 검증·출처 강화 규칙, 경고 배지           | Open     |
| **R-05** | **6개 형식 복잡성 증가**         | **개발지연**     | **중**   | **Phase별 점진적 구현, 의존성 관리**     | **Open** |
| **R-06** | **새 형식 토큰 예산 초과**       | **비용폭증**     | **중**   | **형식별 토큰 상한 엄격 적용, 모니터링** | **Open** |
| **R-07** | **질의서/보고서 법적 리스크**    | **컴플라이언스** | **중**   | **법무팀 검토, 면책조항 강화**           | **Open** |
| **R-08** | **18개 테스트 케이스 관리 부담** | **품질저하**     | **낮음** | **자동화된 회귀 테스트, 단계적 검증**    | **Open** |

---

## 14) ADR(Architecture Decision Record) 템플릿

```md
# ADR-{번호}: {의사결정 제목}

- **상태**: Proposed/Accepted/Deprecated
- **문제**: …
- **변경 옵션**: A/B/…
- **결정**: …
- **근거**: 비용/성능/리스크/유지보수
- **영향**: 코드/문서/운영
- **팔로업**: …
```

---

## 15) 초기 수행 체크리스트 (Kickoff)

- [ ] 리포/CI/코딩 규칙 마련(ESLint/Prettier/TS strict)
- [ ] Vercel 프로젝트 생성 및 `.env` 분리
- [ ] PRD/RULES/ENGINEERING_RULES 확정, 팀 온보딩
- [ ] **대표 케이스 18개 합의 (6형식×3레벨 매트릭스)**
  - [ ] 보도자료: 초급/중급/고급 각 1개씩
  - [ ] 연설문: 초급/중급/고급 각 1개씩
  - [ ] SNS: 초급/중급/고급 각 1개씩
  - [ ] 질의서: 초급/중급/고급 각 1개씩
  - [ ] 보고서: 초급/중급/고급 각 1개씩
  - [ ] 언론스크랩: 초급/중급/고급 각 1개씩
- [ ] **6개 형식 룰팩/체크리스트 v1 릴리즈**
- [ ] 각 형식별 토큰 예산 및 품질 기준선 설정

---

## 16) 샘플 세부 테스크(체크리스트)

### 16.1 룰팩/체크리스트

- [ ] `rulepack.schema.yaml`/`level.schema.yaml`/`tone.schema.yaml` 정의
- [ ] `press_release_v1.yaml`/`speech_v1.yaml`/`sns_v1.yaml`/`inquiry_v1.yaml`/`report_v1.yaml`/`media_scraping_v1.yaml` 작성
- [ ] `press_release_intermediate_v1.md`/`inquiry_intermediate_v1.md`/`report_intermediate_v1.md`/`media_scraping_intermediate_v1.md` 등 체크리스트 작성

### 16.2 API/백엔드

- [ ] `/api/prompt`(Edge) 요청 밸리데이션(Zod)
- [ ] 룰팩 로딩 & 시스템 프롬프트/유저 프롬프트 구성
- [ ] LLM 호출 래퍼(타임아웃/에러 코드/리트라이 정책)
- [ ] 체크리스트 검사 후 warnings 반환
- [ ] 레이트리밋(429) + `Retry-After` 헤더

### 16.3 프론트엔드

- [ ] 주제 입력/형식/레벨/옵션 폼 + 유효성 피드백
- [ ] 결과 프롬프트 뷰 + **복사** 버튼 + 경고 배지
- [ ] 로딩/오류 상태, 접근성(ARIA/포커스)

### 16.4 테스트/관찰성

- [ ] 유닛(스키마/룰팩/체크 함수)
- [ ] API 통합(성공/밸리드 실패/429)
- [ ] 스냅샷(형식×레벨 10종)
- [ ] 로그 필드/PII 마스킹 확인

---

## 17) 메트릭(KPI) 대시보드 항목(초안)

### 기본 메트릭

- 요청 수/성공률/에러율 (전체 + 형식별)
- 평균/백분위 응답시간(P50/P95) (전체 + 형식별)
- 평균 토큰(입/출/총) (전체 + 형식별)
- 경고 빈도(누락/금지어/길이 초과) (형식별)

### 형식별 상세 메트릭

- **기존 형식**: 보도자료/연설문/SNS 사용 분포 및 품질 점수
- **신규 형식**: 질의서/보고서/언론스크랩 도입률 및 만족도
- **형식별 토큰 효율성**: 형식당 평균 토큰 사용량 비교
- **레벨별 분포**: 초/중/고급 사용 패턴 분석

### Phase 2 메트릭

- 프리셋 저장/재사용률 (형식별)
- 6개 형식별 사용자 선호도 분석
- 새로운 형식 학습 곡선 측정

---

## 18) 변경 로그(CHANGELOG) 예시

```md
## [0.1.0] - YYYY-MM-DD

### Added

- Edge `/api/prompt` MVP
- 룰팩 v1(보도자료/연설문/SNS), 체크리스트 v1

### Fixed

- Zod 에러 메시지 한글화

### Changed

- 기본 톤팩을 public_official_v1로 통일
```

---

> 업데이트 시 **PRD/RULES/ENGINEERING_RULES**와 **테스트 케이스(10종)**를 함께 갱신하세요.  
> 모든 날짜/시간/지표는 Asia/Seoul 기준으로 기록합니다.
